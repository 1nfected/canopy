<html lang="en">
<head>
    <meta charset="utf-8">
    <title>canopy test results</title>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css"
        rel="stylesheet">
    <style>
        .masthead ul, .masthead li
        {
            margin-bottom: 0px;
        }
        
        hr
        {
            margin: 0px 0px 20px 0px;
        }
        .table.results
        {
            margin-bottom: 0px;
        }
        
        .table.results td
        {
            border-left: 0px solid #dddddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="masthead">
            <a class="btn" id="Context">New Context</a>
            <a class="btn" id="AddToContext">Add To Context</a>
            <a class="btn" id="Google">Google</a>
            <a class="btn" id="Yahoo">Yahoo</a>  
            <a class="btn" id="Bing">Bing</a>          
            
            <ul class="nav nav-pills">
                <li><a>
                    <label class="checkbox">
                        <input type="checkbox" value="">
                        <span id="passed">0</span>&nbspPassed
                    </label>
                </a></li>
                <li><a>
                    <label class="checkbox">
                        <input type="checkbox" value="">
                        <span id="failed">0</span>&nbspFailed
                    </label>
                </a></li>
                <li><a>
                    <label class="checkbox">
                        <input type="checkbox" value="">
                        <span id="skipped">0</span>&nbspSkipped
                    </label>
                </a></li>
            </ul>
        </div>
        <hr>
        <table class="table table-bordered table-condensed" id="contexts">
            <tbody>
                <tr class="success context" data-context="Google">
                    <td>
                        Context: Google
                    </td>
                </tr>
                <tr class="result">
                    <td>
                        <table class="table results">
                            <tbody>
                                <tr class="success">
                                    <td>
                                        Test #1
                                    </td>
                                </tr>
                                <tr class="success">
                                    <td>
                                        Test #2
                                    </td>
                                </tr>
                                <tr class="success">
                                    <td>
                                        Test #3
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr class="error context" data-context="Yahoo">
                    <td>
                        Context: Yahoo
                    </td>
                </tr>
                <tr class="result">
                    <td>
                        <table class="table results">
                            <tbody>
                                <tr class="error">
                                    <td>
                                        Test #1
                                    </td>
                                </tr>
                                <tr class="success">
                                    <td>
                                        Test #2
                                    </td>
                                </tr>
                                <tr class="error">
                                    <td>
                                        Test #3
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr class="warning context" data-context="Bing">
                    <td>
                        Context: Bing
                    </td>
                </tr>
                <tr class="result">
                    <td>
                        <table class="table results">
                            <tbody>
                                <tr class="success">
                                    <td>
                                        Test #1
                                    </td>
                                </tr>
                                <tr class="warning">
                                    <td>
                                        Test #2
                                    </td>
                                </tr>
                                <tr class="warning">
                                    <td>
                                        Test #3
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
<script type="text/javascript">

    var beginContextResults = function (context) {
        var ctx = $("#contexts").find('tr[data-context="' + context + '"]');
        ctx.after('<tr class="result"><td><table class="table results"><tbody></tbody></table></td></tr>');
    };

    var addContext = function (context) {
        $("#contexts").last('tr').append('<tr class="context" data-context="' + context + '"><td>Context: ' + context + '</td></tr>');
        beginContextResults(context);
    };

    var recalculateTotals = function () {
        $("#passed").text($(".results .success").length);
        $("#failed").text($(".results .error").length);
        $("#skipped").text($(".results .warning").length);
    };

    var addToContext = function (context, passFailSkip) {
        var ctx = $("#contexts").find('tr[data-context="' + context + '"]');
        if (passFailSkip === "Pass") {
            ctx.next('tr').find('table').last('tr').append('<tr class="success"><td>Test #4</td></tr>');
            if (ctx.hasClass("error") === false && ctx.hasClass("warning") === false) {
                ctx.addClass("success");
            }
        }
        if (passFailSkip === "Fail") {
            ctx.next('tr').find('table').last('tr').append('<tr class="error"><td>Test #4</td></tr>');
            ctx.removeClass("success").removeClass("warning").addClass("error");
        }
        if (passFailSkip === "Skip") {
            ctx.next('tr').find('table').last('tr').append('<tr class="warning"><td>Test #4</td></tr>');
            if (ctx.hasClass("error") === false) {
                ctx.removeClass("success").addClass("warning");
            };
        }

        recalculateTotals();
    };

    $(document).ready(function () {
        var random = Math.floor(Math.random() * 1001);

        $("#Context").click(function () {
            addContext("Context " + random);
            addToContext("Context " + random, "Pass");
        });
        $("#AddToContext").click(function () {
            addToContext("Context " + random, "Pass");
        });
        $("#Google").click(function () {
            addToContext("Google", "Fail")
        });
        $("#Yahoo").click(function () {
            addToContext("Yahoo", "Fail")
        });
        $("#Bing").click(function () {
            addToContext("Bing", "Fail")
        });
        
        recalculateTotals();
    });
</script>
</body>
</html>
